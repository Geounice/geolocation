<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Géolocalisation et Azimut avec Realtime Database</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAGVZa33uk5y1PY6vkyCj3-QTu-Uw8Nc98",
            authDomain: "geolocalisation-unice.firebaseapp.com",
            projectId: "geolocalisation-unice",
            storageBucket: "geolocalisation-unice.appspot.com",
            messagingSenderId: "256256594187",
            appId: "1:256256594187:web:f931955318ff8a04b5120e",
            databaseURL: "https://geolocalisation-unice-default-rtdb.europe-west1.firebasedatabase.app/"
        };

        // Initialisation de Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let azimuth = 'Non disponible'; // Initialisation de l'azimut à 'Non disponible'

        function handleDeviceOrientation(event) {
            azimuth = event.alpha; // Orientation de l'appareil en degrés autour de l'axe Z
            document.getElementById("azimuth").textContent = "Azimut: " + (azimuth ? azimuth.toFixed(2) + "°" : "Non disponible");
        }

        async function requestDeviceOrientationPermission() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientation', handleDeviceOrientation, true);
                        } else {
                            console.error("Permission d'orientation refusée");
                        }
                    })
                    .catch(console.error);
            } else {
                // Les permissions ne sont pas nécessaires pour les navigateurs qui ne sont pas iOS 13+
                window.addEventListener('deviceorientation', handleDeviceOrientation, true);
            }
        }

        // Fonctions saveLocationAndAzimuth, retrieveLocationAndAzimuth, et saveCurrentLocationAndAzimuth inchangées

        document.addEventListener('DOMContentLoaded', () => {
            retrieveLocationAndAzimuth();
        });

        // Modification ici pour ajouter le gestionnaire d'événements au bouton existant
        window.onload = function() {
            document.getElementById('requestPermissionButton').addEventListener('click', requestDeviceOrientationPermission);
            document.getElementById('saveLocationButton').addEventListener('click', saveCurrentLocationAndAzimuth);
        };
    </script>
</head>
<body>
    <h2>Localisation et Azimut</h2>
    <button id="requestPermissionButton">Demander la Permission d'Orientation</button>
    <button id="saveLocationButton" onclick="saveCurrentLocationAndAzimuth()">Sauvegarder Localisation et Azimut</button>
    <div>
        <p id="latitude">Latitude: </p>
        <p id="longitude">Longitude: </p>
        <p id="altitude">Altitude: </p>
        <p id="azimuth">Azimut: </p>
    </div>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Géolocalisation avec Firestore</title>
    <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-firestore.js"></script>
    <script>
     // Import the functions you need from the SDKs you need
	import { initializeApp } from "firebase/app";
	// TODO: Add SDKs for Firebase products that you want to use
	// https://firebase.google.com/docs/web/setup#available-libraries

	// Your web app's Firebase configuration
	const firebaseConfig = {
  		apiKey: "AIzaSyDjnCsu2MOWW0ojuzZMaBHmcuDV3FnmRlM",
 		authDomain: "geolocation-unice.firebaseapp.com",
  		projectId: "geolocation-unice",
  		storageBucket: "geolocation-unice.appspot.com",
  		messagingSenderId: "538351327592",
  		appId: "1:538351327592:web:c9f300f31d0baed1ce9edd"
};

	// Initialize Firebase
	const app = initializeApp(firebaseConfig);

      // Initialisation de Firebase
      firebase.initializeApp(firebaseConfig);
      var db = firebase.firestore();
    </script>
</head>
<body>
    <h2>Localisation actuelle</h2>
    <button onclick="getLocation()">Obtenir et sauvegarder la localisation</button>
    <button onclick="retrieveLocation()">Récupérer la dernière localisation</button>
    <p>Latitude: <span id="latitude"></span></p>
    <p>Longitude: <span id="longitude"></span></p>
    <p>Altitude: <span id="altitude"></span></p>

    <script>
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    const altitude = position.coords.altitude || "Non disponible";
                    document.getElementById("latitude").textContent = latitude;
                    document.getElementById("longitude").textContent = longitude;
                    document.getElementById("altitude").textContent = altitude;
                    saveLocation(latitude, longitude, altitude);
                }, function(error) {
                    console.error("Erreur de géolocalisation : ", error);
                });
            } else { 
                alert("La géolocalisation n'est pas supportée par ce navigateur.");
            }
        }

        function saveLocation(latitude, longitude, altitude) {
            db.collection("locations").doc("lastLocation").set({
                latitude: latitude,
                longitude: longitude,
                altitude: altitude,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                console.log("Localisation sauvegardée avec succès !");
            })
            .catch((error) => {
                console.error("Erreur lors de la sauvegarde : ", error);
            });
        }

        function retrieveLocation() {
            db.collection("locations").doc("lastLocation").get().then((doc) => {
                if (doc.exists) {
                    const location = doc.data();
                    document.getElementById("latitude").textContent = location.latitude;
                    document.getElementById("longitude").textContent = location.longitude;
                    document.getElementById("altitude").textContent = location.altitude;
                } else {
                    console.log("Aucune localisation sauvegardée trouvée !");
                }
            }).catch((error) => {
                console.error("Erreur lors de la récupération : ", error);
            });
        }
    </script>
</body>
</html>



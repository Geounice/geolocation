<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Géolocalisation avec Altitude, Azimut et Firebase</title>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>
   	// Import the functions you need from the SDKs you need
	import { initializeApp } from "firebase/app";
	// TODO: Add SDKs for Firebase products that you want to use
	// https://firebase.google.com/docs/web/setup#available-libraries

	// Your web app's Firebase configuration
	const firebaseConfig = {
 		apiKey: "AIzaSyDjnCsu2MOWW0ojuzZMaBHmcuDV3FnmRlM",
  		authDomain: "geolocation-unice.firebaseapp.com",
  		projectId: "geolocation-unice",
  		storageBucket: "geolocation-unice.appspot.com",
 		messagingSenderId: "538351327592",
  		appId: "1:538351327592:web:c9f300f31d0baed1ce9edd"
	};

		// Initialize Firebase
		const app = initializeApp(firebaseConfig);
    </script>
</head>
<body>
    <h2>Localisation actuelle</h2>
    <p>Latitude: <span id="latitude"></span></p>
    <p>Longitude: <span id="longitude"></span></p>
    <p>Altitude: <span id="altitude"></span></p>
    <p>Azimut: <span id="azimuth"></span>°</p>
    <button onclick="getLocation()">Obtenir la localisation</button>
    <button onclick="saveLocation()">Sauvegarder la localisation</button>
    <button onclick="retrieveLocation()">Récupérer la dernière localisation</button>
    <button onclick="copyLocation()">Copier les coordonnées</button>

    <script>
        let currentAzimuth = null;

        // Fonctions getLocation(), showPosition(), showError(), copyLocation() restent inchangées

        function saveLocation() {
            const latitude = document.getElementById("latitude").textContent;
            const longitude = document.getElementById("longitude").textContent;
            const altitude = document.getElementById("altitude").textContent;
            const azimuth = currentAzimuth ? currentAzimuth.toFixed(2) : "Non disponible";
            db.collection("locations").doc("lastLocation").set({
                latitude, longitude, altitude, azimuth,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                alert("Localisation sauvegardée.");
            })
            .catch((error) => {
                console.error("Erreur lors de la sauvegarde : ", error);
            });
        }

        function retrieveLocation() {
            db.collection("locations").doc("lastLocation").get().then((doc) => {
                if (doc.exists) {
                    const location = doc.data();
                    document.getElementById("latitude").textContent = location.latitude;
                    document.getElementById("longitude").textContent = location.longitude;
                    document.getElementById("altitude").textContent = location.altitude;
                    document.getElementById("azimuth").textContent = location.azimuth;
                } else {
                    alert("Aucune localisation sauvegardée.");
                }
            }).catch((error) => {
                console.error("Erreur lors de la récupération : ", error);
            });
        }
    </script>
</body>

